<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>

    <div class="header-img position-absolute z-0 top-0 w-100 h-auto">

    <div class="d-flex align-items-center justify-content-center m-5 z-3  position-relative flex-column">
      <img src="img/f1.png" class="img-fluid f1-logo">
      <h1 class="header main-font text-white txt-shadow">TOP 10 F1</h1>
    </div>

    <div class="container z-3  position-relative shadow-sm">
      <div class="row pointList">
		</div>

    
	</div>	

  <div class="container-fluid mt-5">
    <div id="myData" class="row align-items-center flex-row flex-nowrap overflow-x-auto">
  
  
    </div>
  </div>

  <div class="container-fluid bg-light text-dark text-center">
    <div class="row border-top border-secondary p-4">
      <div class="col-sm-6 ">
        <iframe width="640" height="320" src="https://www.youtube.com/embed/L2cz6Yl1Lxo"
         title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
         allowfullscreen></iframe>
      </div>
      <div class="col-sm-6 align-items-center">
        <div class="d-flex align-items-center h-100 justify-content-center">I de seneste år har F1 gjort et stort spring ind i gamingindustrien ved at samarbejde med spiludviklere og skabe F1-spil. Disse spil giver fans mulighed for at opleve spændingen ved F1-løb på deres computerskærm eller konsol, og det giver dem også mulighed for at føle sig som en del af F1-verdenen.</div>

      </div>
    </div>
    <div class="row border-top border-secondary bg-color text-white p-4">
      <div class="col-sm-6 align-items-center">
        <div class="d-flex align-items-center h-100 justify-content-center">
          Tv2 Echo har netop lavet et spændende indslag om Frederik, en ung dansk racerkører med en stor passion for Formel 1. Frederik har en drøm om at blive verdensmester i F1, og indslaget følger hans rejse mod at nå dette mål.</div>
      </div>

      <div class="col-sm-6">
        <iframe width="640" height="320" src="https://www.youtube.com/embed/mQLxQurDwlQ"
         title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
         allowfullscreen></iframe>
      </div>
    </div>
  <div class="row border-top border-secondary p-4">
    <div class="col-sm-6">
      <iframe width="640" height="320" src="https://www.youtube.com/embed/pBlEwTuXM4c"
        title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen></iframe>
    </div>

    <div class="col-sm-6 align-items-center">
      <div class="d-flex align-items-center h-100 justify-content-center">Crashes er en uundgåelig del af motorsport, og Formel 1 er ingen undtagelse. Selvom sikkerheden i F1 er blevet forbedret markant i de seneste år, kan der stadig ske alvorlige ulykker, når bilerne kører op mod 350 km/t.</div>
    </div>
  </div>

  </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script>
</body>
<footer>

  <script>

    async function getPoints() {
		return await fetch("http://127.0.0.1:8000/points")
			.then((response) => response.json())
			.then((data) => {return data["data"]})
    }


	const minLeft = 42;
	const maxLeft = 82;
	const numberOfPositions = 10;

	const pointList = document.querySelector(".pointList");


	function getCarPosition(position, highestScore) {
		const difference = maxLeft - minLeft;
		const incrementBy = difference / highestScore;
		return minLeft + incrementBy * position;
	}

	function getHighestScore(json) {
		let highestNumber = 0;
		json.forEach(x=> {
			if(x["score"] > highestNumber) {
				highestNumber = x["score"];
			}
		});
		return highestNumber;
	}


	// 42-82

	const timer = ms => new Promise(res => setTimeout(res, ms))
	async function makeCarAnimation() {
		const cars = document.querySelectorAll("img[data-left]")
		cars.forEach(async function(ele, index) {
			let dataLeft = ele.attributes["data-left"]["value"];
			for(let i = minLeft; i < parseInt(dataLeft.replace("%", "")); i++) {
				ele.style.left = i+ "%"
				await timer(10);
			}
		});
	}


	async function handleJson(json) {
		let num = numberOfPositions;
		let highestScore = getHighestScore(json);
		let data = json.map(function(score){
			let left = getCarPosition(score["score"], highestScore)
			num--;
			return`<div class="col-md-12 point-card overflow-hidden">
				<div class="px-2 pt-2 pb-2">
					<div class="row align-items-center position-relative height">
					<div class="col-md-1 text-center">
						<img src="img/${score.logo}" class="img-fluid">
					</div>
					<div class="col-md-6">
						<div class="d-flex align-items-end gap-2">
						<h3 class="main-font font-weight-900 mb-0 text-uppercase">${score.name}</h3>
            <img src="img/flags/${score.flag}" style="height:30px">
						<p class="main-font mb-0 font-weight-600 ">${score.team}</p>
						</div>
					</div>
					<div class="col-md-4 h-100">
						<img src="img/car.png" data-left="${left}%" class="z-999 img-fluid height-50px position-absolute top-50 transform formel-car">
					</div>
					<div class="col-md-1 backeffect">
						<h3 class="main-font z-999 position-relative font-weight-900 text-end formel-text ">${score["score"]}p</h3>
					</div>
					</div>
				</div>
				</div>
			`;
		});
		data = data.join("");
		pointList.innerHTML = data

	}



	function sortJson(json) {
		return json.sort(function(a, b) {return a.score - b.score}).reverse();
	}

	(async function() {
		let json = await getPoints();
		let sortedJson = sortJson(json);
		await handleJson(sortedJson);
		await makeCarAnimation();
	

	})();

	
  (async function() {
    
    const data = await fetch("schedule.json")
      .then((response) => response.json())
      .then((data) => {return data})

      console.log(data)
    
      var mainContainer = document.getElementById("myData");
 let el = "";
  data.forEach(element => {
    let date = new Date(element.date)
    let month = date.toLocaleString('default', { month: 'short' });

    console.log(date.getDate());
    console.log(element);
    el += `<div class="col-md-2 darkcolor justify-content-center py-5 coleffect coleffectborder">
      <img src="img/flags/${element.flag}" class="img-fluid mx-auto d-block" style="height:50px"> 
      <p class="text-center main-font font-weight-900 lh-1 text-uppercase"> ${element.country}</p>
      <h1 class="text-center main-font font-weight-900 lh-1 text-white">${date.getDate()}</h1>
      <p class="text-center main-font font-weight-900 lh-1 text-white text-uppercase pb-5">${month}</p>
    </div> `

  });

  mainContainer.innerHTML = el;

  })();
    


  </script>

</footer>
  
</html>